@model IEnumerable<Wiki.OTK_ChaeckList>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Чек-листы</h2>

<span>
    @Html.ActionLink("Чек-листы", "ChackLists", "ReclamationOTK", null, new { @class = "btn btn-info" })
</span>
<span>
    @Html.ActionLink("Активные замечания", "ActiveReclamation", "ReclamationOTK", null, new { @class = "btn btn-info" })
</span>
<span>
    @Html.ActionLink("Замечания отдела", "Index", "OTK_ChaeckList", null, new { @class = "btn btn-info" })
</span>
<span>
    <a href="http://tpserver/PWA/ProjectBICenter/Sample%20Reports/%d0%9e%d0%b1%d1%89%d0%b8%d0%b5%20%d0%be%d1%82%d1%87%d0%b5%d1%82%d1%8b/%d0%a0%d0%b5%d0%ba%d0%bb%d0%b0%d0%bc%d0%b0%d1%86%d0%b8%d0%b8%20%d0%9e%d0%a2%d0%9a.xlsx" class="btn btn-success" role="button">Excel</a>
</span>
<h3></h3>

<div>
    <table class="table table-striped table-bordered table-hover table-condensed" align="center">
        <tr>
            <th> Дата создания </th>
            <th> № заказа </th>
            <th> Зарегистрирован </th>
            <th> Код МТР </th>
            <th> Замечаний </th>
            <th> Замечаний в работе </th>
            <th> Замечаний без ответа </th>
            <th> Открыть </th>
        </tr>
        @foreach (var item in Model)
        {
            if (@item.OTK_Reclamation.Where(d => d.Complited == false).Count(d => d.Complited == false) > 0)
            {
                <tr class="warning">
                    <td> @item.DateCreate.ToString().Substring(0, 10) </td>
                    <td> @Html.DisplayFor(modelItem => item.PZ_PlanZakaz.PlanZakaz) </td>
                    <td> @Html.DisplayFor(modelItem => item.AspNetUsers.CiliricalName) </td>
                    <td> @Html.DisplayFor(modelItem => item.PZ_PlanZakaz.MTR) </td>
                    <td> @Html.DisplayFor(modelItem => item.OTK_Reclamation.Count) </td>
                    <td> @item.OTK_Reclamation.Where(d => d.Complited == false).Count(d => d.Complited == false) </td>
                    <td> @item.OTK_Reclamation.Where(d => d.AnswerText == "").Count(d => d.AnswerText == "") </td>
                    <td> @Html.ActionLink("Открыть", "IndexCheckList", "ReclamationOTK", new { id = item.id }, new { @class = "btn-sm btn-primary" }) </td>
                </tr>
            }
            else
            {
                <tr>
                    <td> @item.DateCreate.ToString().Substring(0, 10) </td>
                    <td> @Html.DisplayFor(modelItem => item.PZ_PlanZakaz.PlanZakaz) </td>
                    <td> @Html.DisplayFor(modelItem => item.AspNetUsers.CiliricalName) </td>
                    <td> @Html.DisplayFor(modelItem => item.PZ_PlanZakaz.MTR) </td>
                    <td> @Html.DisplayFor(modelItem => item.OTK_Reclamation.Count) </td>
                    <td> @item.OTK_Reclamation.Where(d => d.Complited == false).Count(d => d.Complited == false) </td>
                    <td> @item.OTK_Reclamation.Where(d => d.AnswerText == "").Count(d => d.AnswerText == "") </td>
                    <td> @Html.ActionLink("Открыть", "IndexCheckList", "ReclamationOTK", new { id = item.id }, new { @class = "btn-sm btn-primary" }) </td>
                </tr>
            }

        }
    </table>
</div>